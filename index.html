<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëª¨ë‘  ì¤€ë¹„ë¬¼ ì‹œìŠ¤í…œ</title>
  <link href="style.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <h1>ğŸ“¦ ëª¨ë‘  ì¤€ë¹„ë¬¼ í™•ì¸ ì‹œìŠ¤í…œ</h1>

    <!-- ì´ë¦„ ì…ë ¥ -->
    <div class="card">
      <h2>ì´ë¦„ ì…ë ¥</h2>
      <input type="text" id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="rp-input" />
      <button onclick="checkItems()" class="rp-btn rp-btn--accent">í™•ì¸</button>
      <div id="result"></div>
    </div>

    <!-- ê´€ë¦¬ì ì˜ì—­ -->
    <div class="card" id="adminSection" style="display:none;">
      <h2>ğŸ‘‘ ê´€ë¦¬ì (ë°©ì¥ / ë¶€ë°©ì¥)</h2>

      <h3>ì¤€ë¹„ë¬¼ ì¶”ê°€</h3>
      <input type="text" id="memberName" placeholder="ë©¤ë²„ ì´ë¦„" class="rp-input" />
      <input type="text" id="itemName" placeholder="ì¤€ë¹„ë¬¼" class="rp-input" />
      <button onclick="addItem()" class="rp-btn rp-btn--accent">ì¶”ê°€</button>

      <h3>ëª¨ë“  ì¤€ë¹„ë¬¼</h3>
      <ul id="allItems"></ul>

      <button class="rp-btn rp-btn--accent danger" onclick="clearAll()">ëª¨ë‘ ì´ˆê¸°í™”</button>

    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    // ë°©ì¥, ë¶€ë°©ì¥
    const leaders = ["ê³ ì •ì›", "ê¹€ë¯¼ì„œ"];

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // ğŸ”¥ Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyA-U9ejJEiq2zt7oqJwqxxp1unknmIjQ4g",
      authDomain: "school-edd16.firebaseapp.com",
      databaseURL: "https://school-edd16-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "school-edd16",
      storageBucket: "school-edd16.firebasestorage.app",
      messagingSenderId: "53527232912",
      appId: "1:53527232912:web:2ed62d9faf68a44a64b315"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const itemsRef = ref(db, "items");

    const nameInput = document.getElementById("nameInput");
    const result = document.getElementById("result");
    const adminSection = document.getElementById("adminSection");
    const allItemsList = document.getElementById("allItems");

    let items = {};

    // ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
    onValue(itemsRef, (snapshot) => {
      items = snapshot.val() || {};
      renderAllItems();
    });

    // â­ ì¤€ë¹„ë¬¼ í™•ì¸
    window.checkItems = function () {
      const name = nameInput.value.trim();
      if (!name) {
        result.innerHTML = "âš ï¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”";
        return;
      }

      if (leaders.includes(name)) {
        adminSection.style.display = "block";
        result.innerHTML = "ğŸ‘‘ ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”ë¨";
      } else {
        adminSection.style.display = "none";

        const userItems = items[name];

        if (!userItems || userItems.length === 0) {
          result.innerHTML = `${name}ë‹˜ì˜ ì¤€ë¹„ë¬¼ ì—†ìŒ âœ…`;
          return;
        }

        result.innerHTML = `
          <b>${name}ë‹˜ì˜ ì¤€ë¹„ë¬¼:</b>
          <ul>${userItems.map(i => `<li>${i}</li>`).join("")}</ul>
        `;
      }
    };

    // â­ ì¤€ë¹„ë¬¼ ì¶”ê°€
    window.addItem = function () {
      const member = document.getElementById("memberName").value.trim();
      const item = document.getElementById("itemName").value.trim();

      if (!member || !item) return alert("ì´ë¦„ê³¼ ì¤€ë¹„ë¬¼ì„ ì…ë ¥í•˜ì„¸ìš”");

      const updated = items[member] ? [...items[member], item] : [item];

      set(ref(db, "items/" + member), updated);

      document.getElementById("memberName").value = "";
      document.getElementById("itemName").value = "";
    };


    /* ------------------------------------------------------------------
     ğŸ†• ê¸°ëŠ¥ 1) ë©¤ë²„ ì‚­ì œ
     â†’ íŠ¹ì • ì´ë¦„ ì „ì²´ ë°ì´í„° ì‚­ì œ
    ------------------------------------------------------------------ */
    window.deleteMember = function(name) {
      if (confirm(`${name}ì˜ ëª¨ë“  ì¤€ë¹„ë¬¼ì„ ì‚­ì œí• ê¹Œìš”?`)) {
        remove(ref(db, "items/" + name));
      }
    };


    /* ------------------------------------------------------------------
     ğŸ†• ê¸°ëŠ¥ 2) ì¤€ë¹„ë¬¼ ìˆ˜ì •
     â†’ ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì…ë ¥ì°½ìœ¼ë¡œ ë°”ê¾¼ ë’¤ ì €ì¥
    ------------------------------------------------------------------ */
    window.editItems = function(name) {
      const current = items[name] || [];
      
      const newList = prompt(
        `ğŸ”§ ${name}ì˜ ì¤€ë¹„ë¬¼ì„ ìˆ˜ì • (ì‰¼í‘œë¡œ êµ¬ë¶„)\n\ní˜„ì¬: ${current.join(", ")}`,
        current.join(", ")
      );

      if (newList === null) return; // ì·¨ì†Œ

      const parsed = newList
        .split(",")
        .map(v => v.trim())
        .filter(v => v !== "");

      set(ref(db, "items/" + name), parsed);
    };


    // â­ ê´€ë¦¬ì ì „ì²´ ë³´ê¸° (UI ë Œë”)
    function renderAllItems() {
      allItemsList.innerHTML = "";

      for (let name in items) {
        const li = document.createElement("li");
        const list = items[name].join(", ");

        li.innerHTML = `
          <b>${name}</b>: ${list}
          ğŸ”§ <button onclick="editItems('${name}')" class="rp-btn rp-btn--accent">ìˆ˜ì •</button>
          âŒ <button onclick="deleteMember('${name}')" class="rp-btn rp-btn--accent">ì‚­ì œ</button>
        `;
        allItemsList.appendChild(li);
      }
    }

    // ì „ì²´ ì‚­ì œ
    window.clearAll = function () {
      if (confirm("ì •ë§ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        remove(itemsRef);
      }
    };
  </script>
</body>
</html>
